# **A. Auth0 â€“ Configure Okta as an OAuth2 Social Connection**

## **Overview**

This guide explains how to set up **Okta as a custom OAuth2 social identity provider** in **Auth0**, following the official [Auth0 documentation](https://auth0.com/docs/authenticate/identity-providers/social-identity-providers/configure-okta-as-oauth2-identity-provider) with key working adjustments.

---

## **1. Access the Auth0 Dashboard**

* Log in to your Auth0 tenant at
  `https://manage.auth0.com/dashboard/...`
* From the left navigation panel, go to:
  **Authentication â†’ Social**

---

## **2. Create a New Social Connection**

* Click **+ Create Connection â†’ Custom**.
* Name the connection something descriptive (e.g., **okta-trial-5286963**).
* After creation, open the new connection and select the **Settings** tab.

---

## **3. Configure Basic Settings**

### **General Section**

* **Name:**
  `okta-trial-5286963` (cannot be changed later)
* **Authorization URL:**

  ```
  https://trial-5286963.okta.com/oauth2/default/v1/authorize
  ```
* **Token URL:**

  ```
  https://trial-5286963.okta.com/oauth2/default/v1/token
  ```
* **Scope:**
  `openid`

  > âœ… The scope must be set exactly to `openid`, because the Fetch User Profile Script expects it and does not accept a list.

---

## **4. Add Client Credentials**

* **Client ID:** Paste the Client ID from your Okta application.
* **Client Secret:** Paste the corresponding Client Secret.

You can obtain both from your Okta Admin Console under:
**Applications â†’ [Your App] â†’ General tab â†’ Client Credentials**

---

## **5. Configure the Fetch User Profile Script**

### **Replace the default script** with the following:

```js
function(accessToken, ctx, cb) {
  const url = "https://trial-5286963.okta.com/oauth2/default/v1/userinfo";
  console.log(`Requesting ${url} with access token ${accessToken}`);
  request({
    url: url,
    method: "GET",
    headers: {
      "Authorization": "Bearer " + accessToken,
      "Content-Type": "application/json"
    }
  },
  function(err, resp, body) {
    if (err) return cb(err);
    if (resp.statusCode !== 200) return cb(new Error("Status " + resp.statusCode));
    const profile = JSON.parse(body);
    cb(null, profile);
  });
}
```

> ðŸŸ¢ **Note:**
> The URL must point to your Okta domainâ€™s `/userinfo` endpoint (e.g. `https://trial-xxxxxxx.okta.com/oauth2/default/v1/userinfo`).

---

## **6. Advanced Options**

* Enable **Sync user profile attributes at each login** (toggle ON).
* Click **Save Changes**.

---

## **7. Enable the Connection for Applications**

* Switch to the **Applications** tab within the same connection.
* Turn **ON** the toggle for any app that should use this Okta connection.
  Example:

  * âœ… *BlueJayBird Okta Trial*
  * â˜ *mfa-test-app*
  * â˜ *API Explorer Application*

> âš ï¸ The connection will not work until itâ€™s explicitly enabled for your target application(s).

---

## **8. Test the Connection**

* Return to the top of the Social Connection screen.
* Click **Try Connection**.
* Log in with your Okta credentials to verify that tokens and user info are returned successfully.

---

## **9. Debugging the Fetch User Profile Script**

### **To view logs in real time:**

1. Go to **Extensions â†’ Real-time Webtask Logs** in Auth0.
2. Install it if not already present.
3. Open the extension â€” it displays console output from your Fetch User Profile Script.
4. Use `console.log()` statements to debug token and response handling.

---

âœ… **Setup Complete**

Youâ€™ve now successfully configured **Okta as an OAuth2 social identity provider** in Auth0.
Your configuration includes:

* Proper `openid` scope
* Custom userinfo endpoint script
* Profile sync on login
* Connection enabled for selected applications
* Live debugging through *Real-time Webtask Logs*

---
---
---
---
---
---

# **B. Auth0 Application Setup Guide â€“ BlueJayBird Okta Trial**

## **Overview**

This guide details how to configure the **BlueJayBird Okta Trial** application in **Auth0**.
It highlights the specific settings changed from defaults and explains how to manage social and directory connections for secure local testing.

---

## **1. Access the Application**

* Log in to your Auth0 tenant at:
  `https://manage.auth0.com/dashboard/...`
* Navigate to:
  **Applications â†’ Applications**
* Select the application: **BlueJayBird Okta Trial**

---

## **2. Basic Application Settings**

### **Basic Information**

* **Name:** `BlueJayBird Okta Trial`
* **Domain:**
  Example: `dev-vx3g0onl.us.auth0.com`
* **Client ID** and **Client Secret:** Automatically generated by Auth0.
  *(These will be used in your Node.js app configuration.)*

> ðŸ’¡ Keep your **Client Secret** secure â€” it authenticates your app to Auth0.

---

## **3. Application Type and Properties**

* **Application Type:** `Regular Web Application`
* **Token Endpoint Authentication Method:** `Post`
* **Description / Logo:** Optional; defaults are fine.

> âš™ï¸ You can leave most other fields as default â€” only the **callback** and **logout** URLs need customization.

---

## **4. Application URIs**

Set these values under **Application URIs**:

* **Application Login URI:** *(optional)*
  `https://myapp.org/login`
* **Allowed Callback URLs:**

  ```
  http://localhost:8080/callback
  ```
* **Allowed Logout URLs:**

  ```
  http://localhost:8080
  ```
* **Allowed Web Origins:** Leave blank unless your app needs CORS support.

> âœ… These URLs must match exactly what your local app uses, or authentication will fail.

---

## **5. Token and Refresh Settings**

Leave these at defaults unless required otherwise.

* **ID Token Expiration:** 36000 seconds
* **Refresh Token Rotation:** Disabled
* **Absolute Expiration:** Disabled
* **Inactivity Expiration:** Disabled
* **Absolute Lifetime:** 31557600 seconds
* **Inactivity Lifetime:** 2592000 seconds

> â„¹ï¸ These defaults are sufficient for most development and test environments.

---

## **6. Connections**

### **Managing Linked Identity Providers**

* Open the **Connections** tab.
* Disable any unintended connections (e.g., **Cognito user pools** that may be auto-enabled).
* Ensure only the desired connections are active.

  * âœ… *okta-trial-5286963* (Social â€“ Custom)
  * âŒ *Unneeded Cognito or database connections*

> âš ï¸ Leaving extra connections enabled may result in unexpected tokens (e.g., access tokens from other identity providers being injected into cookies).
> Once disabled, only the session will be created â€” which is safer and cleaner for your integration.

---

## **7. Organizations (Optional Feature)**

* Navigate to the **Organizations** tab.
* Leave defaults unless you plan to support multi-organization login.
* **End-user access type:**
  `Individuals for personal use`
* **Display Organization Prompt:** Leave OFF.

> âš ï¸ If your app uses grants like *Client Credentials*, *Password*, or *MFA*, these are not compatible with Organizations.
> Youâ€™ll see a banner with the option **Disable Grants Now** â€” leave as-is unless you explicitly plan to integrate Organizations.

---

## **8. Local Node.js Application Integration**

### **Quick Start Implementation**

* Follow Auth0â€™s **Node.js + Express Quick Start Tutorial**.
  It walks through installing dependencies, configuring routes, and securing endpoints.

> ðŸ“˜ Reference: [Auth0 Node.js Quickstart Guide](https://auth0.com/docs/quickstart/webapp/express)

### **Configuration Values**

In your appâ€™s configuration file (e.g., `blue-jay-bird/src/index.js`):

```js
const config = {
  authRequired: false,
  auth0Logout: true,
  secret: 'YOUR_GENERATED_SECRET',
  baseURL: 'http://localhost:8080',
  clientID: 'YOUR_AUTH0_CLIENT_ID',
  issuerBaseURL: 'https://dev-vx3g0onl.us.auth0.com'
};
```

### **Secret Generation**

* The value for `config.secret` was generated using:

  ```
  openssl rand -hex 32
  ```

> ðŸ§  This secret is for signing session cookies.
> It is **not** a PKCE â€” PKCE applies to public clients (e.g., SPAs or mobile apps), while your app uses a confidential client with a static secret.

---

## **9. Saved Reference Scripts**

* The **Fetch User Profile Script** (from your Okta connection) was stored in your app for reference:

  ```
  blue-jay-bird/src/auth0/scripts/
  ```

> This is the same script used by Auth0â€™s *Custom Social Connection* to retrieve the user profile from Oktaâ€™s `/userinfo` endpoint.

---

## **10. Testing the Integration**

1. Start your Node.js app locally:

   ```
   npm start
   ```
2. Visit `http://localhost:8080`
3. Log in using your Okta credentials.
4. Confirm successful redirect and session creation.

> If you previously saw an unexpected access token (from your companyâ€™s directory) â€” that was due to default Cognito connections. With those disabled, only Auth0 session cookies should now appear.

---

âœ… **Setup Complete**

Your **BlueJayBird Okta Trial** Auth0 Application is now properly configured with:

* Correct callback and logout URLs
* Secure connection management
* Node.js + Express Quick Start integration
* Proper session handling (no extra access tokens)
* Optional organizational setup for future scaling

---

Would you like me to turn this into a **formatted Markdown (.md)** or **PDF** file like the other guides, so you can keep them together as a documented setup package?
